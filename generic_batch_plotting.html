<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Generic Batch Spectrogram Plotting &#8212; Configurable Spectrograms  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Batching and Buffered Logging" href="batching_and_logging.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="generic-batch-spectrogram-plotting">
<h1>Generic Batch Spectrogram Plotting<a class="headerlink" href="#generic-batch-spectrogram-plotting" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The module <code class="docutils literal notranslate"><span class="pre">batch_multi_plot_spectrogram.py</span></code> provides a <strong>data-agnostic</strong> batch
pipeline for generating multi-row spectrogram figures with optional per-row
color scaling overrides, batched progress persistence, resumable execution, and
buffered logging. It mirrors the FAST-specific implementation while removing
mission-specific assumptions.</p>
</section>
<section id="key-public-functions">
<h2>Key Public Functions<a class="headerlink" href="#key-public-functions" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">generic_batch_plot</span></code></dt><dd><p>High-level orchestration that iterates over item identifiers (any iterable)
and invokes plotting for each data container while batching JSON progress writes
and log flushing. Accepts <code class="docutils literal notranslate"><span class="pre">install_signal_handlers</span></code> to opt out of temporary
SIGINT handler installation in embedded environments.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">generic_plot_spectrogram_set</span></code></dt><dd><p>Render a multi-row spectrogram grid for a single logical item (e.g., orbit),
applying per-row y/z min/max overrides and optional percentile-based color scaling.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">make_spectrogram</span></code></dt><dd><p>Low-level helper to collapse a 3D data cube along one axis and render a single
spectrogram panel with linear or logarithmic y and z scaling.</p>
</dd>
</dl>
</section>
<section id="batching-parameters">
<h2>Batching Parameters<a class="headerlink" href="#batching-parameters" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">flush_batch_size</span></code></dt><dd><p>Number of successfully processed items buffered before progress JSON (and any
extrema-like state) is persisted. Final flush always occurs at normal termination.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">log_flush_batch_size</span></code></dt><dd><p>Size of the in-memory log message buffer; defaults to <code class="docutils literal notranslate"><span class="pre">flush_batch_size</span></code> when
unspecified.</p>
</dd>
</dl>
</section>
<section id="progress-json-schema-generic">
<h2>Progress JSON Schema (Generic)<a class="headerlink" href="#progress-json-schema-generic" title="Link to this heading">¶</a></h2>
<p>The progress JSON managed by <code class="docutils literal notranslate"><span class="pre">generic_batch_plot</span></code> contains keys (illustrative):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;completed_items&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;itemA&quot;</span><span class="p">,</span> <span class="s2">&quot;itemB&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;itemC&quot;</span><span class="p">],</span>
    <span class="s2">&quot;no_data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;itemD&quot;</span><span class="p">],</span>
    <span class="s2">&quot;last_index&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;schema_version&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>Notes:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">errors</span></code> is a list of item representations; detailed exception text lives</dt><dd><p>only in the log file to keep resumable state compact and schema-stable.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">last_index</span></code> is the zero-based index in the original <code class="docutils literal notranslate"><span class="pre">items</span></code> iterable</dt><dd><p>of the most recently processed entry (useful for sanity checks / debugging).</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>Resumability is supported by reloading this file unless <code class="docutils literal notranslate"><span class="pre">ignore_progress_json=True</span></code>.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<section id="minimal-run">
<h3>Minimal Run<a class="headerlink" href="#minimal-run" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">batch_multi_plot_spectrogram</span><span class="w"> </span><span class="kn">import</span> <span class="n">generic_batch_plot</span>

<span class="c1"># Suppose we have a pre-built list of items and a loader that yields datasets</span>
<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orbit_001&quot;</span><span class="p">,</span> <span class="s2">&quot;orbit_002&quot;</span><span class="p">,</span> <span class="s2">&quot;orbit_003&quot;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_datasets_for_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span>
    <span class="c1"># Return list[dict] each with keys: x, y, data, label (and optional vmin/vmax)</span>
    <span class="k">return</span> <span class="n">build_datasets</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>  <span class="c1"># user-defined</span>

<span class="n">generic_batch_plot</span><span class="p">(</span>
    <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;plots_generic&quot;</span><span class="p">,</span>
    <span class="n">build_datasets_fn</span><span class="o">=</span><span class="n">load_datasets_for_item</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-batching-and-logging">
<h3>Custom Batching and Logging<a class="headerlink" href="#custom-batching-and-logging" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generic_batch_plot</span><span class="p">(</span>
    <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;plots_generic&quot;</span><span class="p">,</span>
    <span class="n">build_datasets_fn</span><span class="o">=</span><span class="n">load_datasets_for_item</span><span class="p">,</span>
    <span class="n">flush_batch_size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">log_flush_batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="resuming-after-interruption">
<h3>Resuming After Interruption<a class="headerlink" href="#resuming-after-interruption" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generic_batch_plot</span><span class="p">(</span>
    <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;plots_generic&quot;</span><span class="p">,</span>
    <span class="n">build_datasets_fn</span><span class="o">=</span><span class="n">load_datasets_for_item</span><span class="p">,</span>
    <span class="n">progress_json_path</span><span class="o">=</span><span class="s2">&quot;generic_progress.json&quot;</span><span class="p">,</span>  <span class="c1"># default</span>
<span class="p">)</span>  <span class="c1"># picks up where it left off</span>
</pre></div>
</div>
<p>Force Fresh Processing (ignore prior progress):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generic_batch_plot</span><span class="p">(</span>
    <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;plots_generic&quot;</span><span class="p">,</span>
    <span class="n">build_datasets_fn</span><span class="o">=</span><span class="n">load_datasets_for_item</span><span class="p">,</span>
    <span class="n">ignore_progress_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="per-row-min-max-overrides">
<h3>Per-Row Min/Max Overrides<a class="headerlink" href="#per-row-min-max-overrides" title="Link to this heading">¶</a></h3>
<p>Each dataset dict may include per-row overrides (all optional): <code class="docutils literal notranslate"><span class="pre">y_min</span></code>, <code class="docutils literal notranslate"><span class="pre">y_max</span></code>,
<code class="docutils literal notranslate"><span class="pre">z_min</span></code>, <code class="docutils literal notranslate"><span class="pre">z_max</span></code> plus optional precomputed color scale bounds <code class="docutils literal notranslate"><span class="pre">vmin</span></code> / <code class="docutils literal notranslate"><span class="pre">vmax</span></code>.
When <code class="docutils literal notranslate"><span class="pre">z_min</span></code> / <code class="docutils literal notranslate"><span class="pre">z_max</span></code> are absent but <code class="docutils literal notranslate"><span class="pre">vmin</span></code> / <code class="docutils literal notranslate"><span class="pre">vmax</span></code> are present, those act
as the row’s native color limits (still clamped by any global <code class="docutils literal notranslate"><span class="pre">z_min</span></code>/<code class="docutils literal notranslate"><span class="pre">z_max</span></code>
arguments passed to <code class="docutils literal notranslate"><span class="pre">generic_plot_spectrogram_set</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_datasets_for_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">d1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;EES&quot;</span><span class="p">,</span> <span class="s2">&quot;y_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y_max&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x2</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y2</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">d2</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;IES&quot;</span><span class="p">,</span> <span class="s2">&quot;z_min&quot;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="s2">&quot;z_max&quot;</span><span class="p">:</span> <span class="mf">1e2</span><span class="p">},</span>
    <span class="p">]</span>

<span class="n">generic_batch_plot</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="s2">&quot;plots_generic&quot;</span><span class="p">,</span> <span class="n">load_datasets_for_item</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="zoom-column-and-event-lines">
<h3>Zoom Column and Event Lines<a class="headerlink" href="#zoom-column-and-event-lines" title="Link to this heading">¶</a></h3>
<p>Provide <code class="docutils literal notranslate"><span class="pre">vertical_lines</span></code> (UNIX timestamps) and a <code class="docutils literal notranslate"><span class="pre">zoom_duration_minutes</span></code> to add an
optional right-hand zoom column when data exist inside the derived window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generic_plot_spectrogram_set</span><span class="p">(</span>
    <span class="n">datasets</span><span class="o">=</span><span class="n">my_datasets</span><span class="p">,</span>
    <span class="n">vertical_lines</span><span class="o">=</span><span class="p">[</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">],</span>
    <span class="n">zoom_duration_minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span>
    <span class="n">z_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="low-level-single-panel">
<h3>Low-Level Single Panel<a class="headerlink" href="#low-level-single-panel" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">batch_multi_plot_spectrogram</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_spectrogram</span>

<span class="n">ax</span><span class="p">,</span> <span class="n">x_used</span> <span class="o">=</span> <span class="n">make_spectrogram</span><span class="p">(</span>
    <span class="n">x_axis_values</span><span class="o">=</span><span class="n">time_sec</span><span class="p">,</span>
    <span class="n">y_axis_values</span><span class="o">=</span><span class="n">energy_ev</span><span class="p">,</span>
    <span class="n">data_array_3d</span><span class="o">=</span><span class="n">data_cube</span><span class="p">,</span>
    <span class="n">collapse_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">y_axis_scale_function</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">z_axis_scale_function</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;EES&quot;</span><span class="p">,</span>
    <span class="n">vertical_lines_unix</span><span class="o">=</span><span class="p">[</span><span class="n">event_time</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="percentile-based-color-scaling">
<h3>Percentile-Based Color Scaling<a class="headerlink" href="#percentile-based-color-scaling" title="Link to this heading">¶</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">z_axis_min</span></code> or <code class="docutils literal notranslate"><span class="pre">z_axis_max</span></code> are omitted, internal logic selects robust
percentile-based bounds (see function docstring). Provide explicit bounds to
fully control the color scale. Precomputing and supplying <code class="docutils literal notranslate"><span class="pre">vmin</span></code>/<code class="docutils literal notranslate"><span class="pre">vmax</span></code> when
assembling datasets avoids recomputation in tight loops.</p>
</section>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h2>
<p>All exceptions are captured with descriptive variable names; errors are recorded in
<code class="docutils literal notranslate"><span class="pre">errors</span></code> within the progress JSON while processing continues with remaining items.</p>
</section>
<section id="implementation-notes">
<h2>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Logging is buffered; call-level helpers flush automatically at batch boundaries.</p></li>
<li><p>Figures are explicitly closed via <code class="docutils literal notranslate"><span class="pre">close_all_axes_and_clear</span></code> to control memory use.</p></li>
<li><p>The module is intentionally stateless apart from in-memory log and progress batching.</p></li>
<li><dl class="simple">
<dt>A temporary SIGINT handler is installed (and restored) when <code class="docutils literal notranslate"><span class="pre">install_signal_handlers=True</span></code>.</dt><dd><p>Disable this in notebooks / embedded shells if global handler changes cause side-effects.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="axis-label-defaults">
<h2>Axis Label Defaults<a class="headerlink" href="#axis-label-defaults" title="Link to this heading">¶</a></h2>
<p>Unless overridden per dataset row, the following label defaults are applied:</p>
<ul class="simple">
<li><p>Y-axis: <code class="docutils literal notranslate"><span class="pre">Energy</span> <span class="pre">(eV)</span></code></p></li>
<li><p>Colorbar (Z): <code class="docutils literal notranslate"><span class="pre">Counts</span></code></p></li>
</ul>
<p>Provide <code class="docutils literal notranslate"><span class="pre">y_label</span></code> / <code class="docutils literal notranslate"><span class="pre">z_label</span></code> keys in each dataset dict to customize units
or semantics (e.g., <code class="docutils literal notranslate"><span class="pre">'Differential</span> <span class="pre">Flux</span> <span class="pre">(eV</span> <span class="pre">cm^-2</span> <span class="pre">s^-1</span> <span class="pre">sr^-1)'</span></code>). Global
changes can be introduced at the dataset construction layer to keep the batch
orchestration code data-agnostic.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="batching_and_logging.html"><span class="doc">Batching and Buffered Logging</span></a> for shared batching semantics.</p></li>
<li><p>FAST-specific orchestration: <code class="docutils literal notranslate"><span class="pre">FAST_plot_spectrograms_directory</span></code> in the mission module.</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Configurable Spectrograms</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="modules.html">Module Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="batching_and_logging.html">Batching and Buffered Logging</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generic Batch Spectrogram Plotting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-public-functions">Key Public Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batching-parameters">Batching Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#progress-json-schema-generic">Progress JSON Schema (Generic)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-notes">Implementation Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#axis-label-defaults">Axis Label Defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="batching_and_logging.html" title="previous chapter">Batching and Buffered Logging</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Ev Hansen.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/generic_batch_plotting.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>